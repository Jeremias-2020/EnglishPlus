<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#002868">
    <title>EnglishPlus | American English Simulator</title>
    
    <link rel="manifest" href="data:application/manifest+json,{%22name%22:%22EnglishPlus%22,%22short_name%22:%22EnglishPlus%22,%22start_url%22:%22.%22,%22display%22:%22standalone%22,%22background_color%22:%22#ffffff%22,%22theme_color%22:%22#002868%22,%22icons%22:[{%22src%22:%22https://i.postimg.cc/k4xT20pL/Imagen1.png%22,%22sizes%22:%22512x512%22,%22type%22:%22image/png%22}]}">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { 
            --primary: #002868; 
            --secondary: #bf0a30; 
            --bg: #f8fafc; 
            --card: #ffffff; 
            --accent: #eef2ff; 
        }
        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            transition: all 0.2s ease; 
        }
        body { 
            font-family: 'Inter', sans-serif; 
            background: var(--bg); 
            margin: 0; 
            padding-bottom: 90px; 
            color: #1e293b; 
        }
        
        header { 
            background: var(--card); 
            padding: 25px; 
            text-align: center; 
            border-bottom: 4px solid var(--primary); 
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); 
        }
        .logo { 
            max-width: 240px; 
            height: auto; 
        }
        .subtitle { 
            font-size: 0.8rem; 
            color: #64748b; 
            font-weight: 700; 
            margin-top: 8px; 
            text-transform: uppercase; 
            letter-spacing: 1px; 
        }

        .container { 
            max-width: 700px; 
            margin: 25px auto; 
            padding: 0 20px; 
        }
        .search-bar { 
            display: flex; 
            gap: 12px; 
            margin-bottom: 25px; 
        }
        input { 
            flex: 1; 
            padding: 16px; 
            border: 2px solid #e2e8f0; 
            border-radius: 14px; 
            font-size: 1.1rem; 
            outline: none; 
        }
        input:focus { 
            border-color: var(--primary); 
            box-shadow: 0 0 0 4px rgba(0,40,104,0.1); 
        }
        .btn-main { 
            background: var(--primary); 
            color: white; 
            border: none; 
            padding: 0 25px; 
            border-radius: 14px; 
            font-weight: 800; 
            cursor: pointer; 
            font-size: 1rem;
        }
        .btn-main:hover {
            background: #003a8c;
            transform: translateY(-2px);
        }
        .btn-main:disabled {
            background: #94a3b8;
            cursor: not-allowed;
            transform: none;
        }

        .app-card { 
            background: var(--card); 
            border-radius: 24px; 
            padding: 35px; 
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.05); 
            min-height: 400px; 
        }
        
        /* Word Result Styling */
        .word-result-header { 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            border-bottom: 2px solid var(--bg); 
            padding-bottom: 20px; 
            margin-bottom: 25px; 
        }
        .word-title { 
            font-size: 2.5rem; 
            margin: 0; 
            color: var(--primary); 
            font-weight: 800; 
            text-transform: lowercase; 
        }
        .ipa { 
            font-size: 1.3rem; 
            color: #64748b; 
            font-family: 'Georgia', serif; 
            font-style: italic; 
        }
        .btn-audio { 
            font-size: 1.8rem; 
            background: var(--accent); 
            border: none; 
            width: 60px; 
            height: 60px; 
            border-radius: 50%; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }
        .btn-audio:hover { 
            background: #e0e7ff; 
            transform: scale(1.1); 
        }

        .section-h { 
            color: var(--secondary); 
            font-size: 0.9rem; 
            font-weight: 800; 
            text-transform: uppercase; 
            margin-top: 30px; 
            margin-bottom: 10px; 
            display: flex; 
            align-items: center; 
            gap: 8px; 
        }
        .content { 
            font-size: 1.05rem; 
            line-height: 1.7; 
            color: #334155; 
            margin-bottom: 15px; 
            white-space: pre-wrap;
        }
        .content b { 
            color: var(--primary); 
        }
        .pro-tip { 
            background: #fffbeb; 
            border: 1px solid #fef3c7; 
            padding: 20px; 
            border-radius: 15px; 
            margin-top: 25px; 
        }

        /* Navigation */
        nav { 
            position: fixed; 
            bottom: 0; 
            width: 100%; 
            background: white; 
            display: flex; 
            justify-content: space-around; 
            padding: 15px 0; 
            border-top: 1px solid #e2e8f0; 
            box-shadow: 0 -4px 10px rgba(0,0,0,0.03); 
            z-index: 1000; 
        }
        .nav-item { 
            border: none; 
            background: none; 
            font-weight: 700; 
            color: #94a3b8; 
            cursor: pointer; 
            font-size: 0.85rem; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 4px; 
            padding: 8px 16px;
        }
        .nav-item.active { 
            color: var(--primary); 
        }
        .nav-item:hover {
            color: var(--primary);
        }

        .hidden { 
            display: none !important; 
        }
        
        .list-item { 
            padding: 18px; 
            border-bottom: 1px solid #f1f5f9; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            font-weight: 700; 
            cursor: pointer; 
            border-radius: 12px; 
        }
        .list-item:hover { 
            background: var(--accent); 
            color: var(--primary); 
        }
        
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: #94a3b8;
        }
        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }
        
        .loading {
            text-align: center;
            padding: 60px 20px;
        }
        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .search-input-wrapper {
            position: relative;
            margin-bottom: 20px;
        }
        .search-input-wrapper input {
            width: 100%;
            padding-left: 45px;
        }
        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2rem;
            color: #94a3b8;
        }
    </style>
</head>
<body>

<header>
    <img src="https://i.postimg.cc/k4xT20pL/Imagen1.png" alt="EnglishPlus" class="logo">
    <div class="subtitle">American English Vocabulary Simulator by Carlos Mario Navarro</div>
</header>

<div class="container">
    <div class="search-bar">
        <input type="text" id="word-input" placeholder="Ex: Relentless, Thorough, Subtle..." onkeypress="if(event.key==='Enter') handleSubmit()">
        <button class="btn-main" id="explore-btn" onclick="handleSubmit()">EXPLORE</button>
    </div>

    <div class="app-card">
        <!-- Home View -->
        <div id="view-home" class="empty-state">
            <div class="empty-state-icon">üá∫üá∏</div>
            <h2 style="color: var(--primary);">Ready to level up?</h2>
            <p>Type any word to get a full pedagogical breakdown with AI-powered explanations.</p>
        </div>
        
        <!-- Loading State -->
        <div id="view-loading" class="hidden loading">
            <div class="spinner"></div>
            <p style="color: var(--primary); font-weight: 700;">Generating explanation...</p>
        </div>
        
        <!-- Result View -->
        <div id="view-result" class="hidden"></div>
        
        <!-- List View -->
        <div id="view-list" class="hidden">
            <div class="search-input-wrapper">
                <span class="search-icon">üîç</span>
                <input type="text" id="search-filter" placeholder="Search your vocabulary..." oninput="filterList()">
            </div>
            <h3 id="list-title" style="color: var(--primary); margin-bottom: 20px;">History</h3>
            <div id="list-items"></div>
        </div>
    </div>
</div>

<nav>
    <button class="nav-item active" id="nav-home" onclick="showTab('home')">
        <span>üè†</span>SIMULATOR
    </button>
    <button class="nav-item" id="nav-hist" onclick="showTab('hist')">
        <span>üïí</span>HISTORY
    </button>
    <button class="nav-item" id="nav-alpha" onclick="showTab('alpha')">
        <span>üî§</span>A-Z LIST
    </button>
</nav>

<script>
    // Global state
    let history = [];
    let currentWord = null;
    let audioElement = new Audio();
    let currentTab = 'home';

    // IPA pronunciation database
    const ipaDatabase = {
        'well': 'w…õl',
        'utmost': 'Àà åtÀåmo äst',
        'important': '…™mÀàp…îÀêrt…ônt',
        'beautiful': 'ÀàbjuÀêt…™f…ôl',
        'excellent': 'Àà…õks…ôl…ônt',
        'amazing': '…ôÀàme…™z…™≈ã',
        'wonderful': 'Ààw ånd…ôrf…ôl',
        'fantastic': 'f√¶nÀàt√¶st…™k',
        'great': '…°re…™t',
        'good': '…° äd',
        'bad': 'b√¶d',
        'terrible': 'Ààt…õr…ôb…ôl',
        'awesome': 'Àà…îÀês…ôm',
        'incredible': '…™nÀàkr…õd…ôb…ôl',
        'outstanding': 'a ätÀàst√¶nd…™≈ã',
        'remarkable': 'r…™Ààm…ëÀêrk…ôb…ôl',
        'enough': '…™Ààn åf',
        'through': 'Œ∏ruÀê',
        'thought': 'Œ∏…îÀêt',
        'tough': 't åf',
        'though': '√∞o ä',
        'thorough': 'ÀàŒ∏…úÀêro ä',
        'word': 'w…úÀêrd',
        'world': 'w…úÀêrld',
        'work': 'w…úÀêrk',
        'people': 'ÀàpiÀêp…ôl',
        'about': '…ôÀàba ät',
        'because': 'b…™Ààk…îÀêz',
        'before': 'b…™Ààf…îÀêr',
        'after': 'Àà√¶ft…ôr',
        'always': 'Àà…îÀêlwe…™z',
        'never': 'Ààn…õv…ôr',
        'relentless': 'r…™Ààl…õntl…ôs',
        'subtle': 'Ààs åt…ôl'
    };

    // Initialize
    function init() {
        loadHistory();
    }

    // Load history
    function loadHistory() {
        const saved = localStorage.getItem('ep_vocab_history');
        if (saved) {
            history = JSON.parse(saved);
        }
    }

    // Save history
    function saveHistory() {
        localStorage.setItem('ep_vocab_history', JSON.stringify(history));
    }

    // Get IPA
    function getIPA(word) {
        return ipaDatabase[word.toLowerCase()] || 'pronunciation varies';
    }

    // Play audio
    function playAudio(text) {
        audioElement.pause();
        audioElement.currentTime = 0;
        
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'en-US';
        utterance.rate = 0.75;
        utterance.pitch = 1.0;
        utterance.volume = 1.0;
        
        speechSynthesis.cancel();
        setTimeout(() => {
            speechSynthesis.speak(utterance);
        }, 50);
    }

    // Generate explanation using Claude API
    async function generateExplanation(word) {
        try {
            const response = await fetch("https://api.anthropic.com/v1/messages", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    model: "claude-sonnet-4-20250514",
                    max_tokens: 4000,
                    messages: [{
                        role: "user",
                        content: `You are a Senior Educational Software Designer and American English linguist. 

Provide a comprehensive vocabulary explanation for the word: "${word}"

IMPORTANT: At the very beginning, provide ONLY the American English IPA pronunciation in this exact format:
IPA: /exact-ipa-here/

Then follow this EXACT structure and tone for the rest:

**Opening (warm and engaging)**
Start with "That is a fantastic word!" or similar. Then provide a brief, natural explanation of what the word means and how it's commonly used in American English.

**Word Analysis: [WORD IN CAPS]**

**English Meaning üá∫üá∏**
- Part of speech with definition
- Include multiple meanings if applicable

**Synonyms ü§ù**
- List 4-5 synonyms with brief contextual notes in parentheses

**Antonyms üö´**
- List 3-4 antonyms with brief explanations

**Common Expressions & Phrases üó£Ô∏è**
- List 3-5 common phrases or collocations with this word in quotes

**Real-World Examples üìù**
- Provide 3-4 authentic American English examples showing the word in context
- Use professional and everyday scenarios

**Visualizing [Concept] üìà** (if applicable)
- Provide a conceptual explanation or framework

**Friendly Practice (The American Way) üá∫üá∏**
- Give a practical professional usage example

**Tip Pro: [Related confusion or usage note] üí°**
- Address common mistakes or confusions

**End with an engaging practice prompt**

Write everything in American English. Be warm, professional, and pedagogically sound. Use emojis as shown above. Make it educational but friendly.`
                    }]
                })
            });

            const data = await response.json();
            let explanation = data.content[0].text;
            
            // Extract IPA if provided
            const ipaMatch = explanation.match(/IPA:\s*\/([^\/]+)\//);
            let extractedIPA = null;
            if (ipaMatch) {
                extractedIPA = ipaMatch[1];
                explanation = explanation.replace(/IPA:\s*\/[^\/]+\/\s*\n*/g, '');
            }
            
            return { explanation, ipa: extractedIPA };
        } catch (error) {
            console.error('API Error:', error);
            return { 
                explanation: generateFallbackExplanation(word), 
                ipa: null 
            };
        }
    }

    // Fallback explanation
    function generateFallbackExplanation(word) {
        return `That is a fantastic word! "${word}" is an important term in American English that you'll encounter frequently in both professional and casual contexts.

**Word Analysis: ${word.toUpperCase()}**

**English Meaning üá∫üá∏**
This word carries significant meaning in American English communication. Understanding its proper usage will enhance your fluency and help you express yourself more precisely.

**Synonyms ü§ù**
- Related terms (context-dependent)
- Similar expressions (common usage)
- Alternative words (formal settings)

**Antonyms üö´**
- Opposite meaning (contrast)
- Contrary terms (different context)

**Common Expressions & Phrases üó£Ô∏è**
This word appears in many everyday expressions that native speakers use regularly.

**Real-World Examples üìù**
- Professional context: You'll hear this in business meetings and formal communications
- Everyday usage: Common in casual conversation with friends and colleagues
- Written form: Frequently appears in emails, reports, and articles

**Friendly Practice (The American Way) üá∫üá∏**
Try using this word in your next conversation! Americans appreciate when non-native speakers use vocabulary with confidence and precision.

**Tip Pro üí°**
Remember that context is key in American English. The same word can have different connotations depending on the situation and tone.

Practice using "${word}" in three different sentences today to build your confidence! üéØ`;
    }

    // Handle submit
    async function handleSubmit() {
        const input = document.getElementById('word-input');
        const word = input.value.trim().toLowerCase();
        
        if (!word) return;

        // Show loading
        showView('loading');
        document.getElementById('explore-btn').disabled = true;
        document.getElementById('explore-btn').textContent = 'LOADING...';

        try {
            // Generate explanation
            const result = await generateExplanation(word);
            const finalIPA = result.ipa || getIPA(word);

            // Create word data
            const wordData = {
                word: word,
                ipa: finalIPA,
                explanation: result.explanation,
                timestamp: new Date().toISOString()
            };

            currentWord = wordData;

            // Add to history (remove duplicates)
            history = history.filter(item => item.word !== word);
            history.unshift(wordData);
            saveHistory();

            // Display word
            displayWord(wordData);
            showView('result');
        } catch (error) {
            console.error('Error:', error);
            alert('An error occurred. Please try again.');
            showView('home');
        }

        // Reset input
        input.value = '';
        document.getElementById('explore-btn').disabled = false;
        document.getElementById('explore-btn').textContent = 'EXPLORE';
    }

    // Display word
    function displayWord(wordData) {
        const resultDiv = document.getElementById('view-result');
        resultDiv.innerHTML = `
            <div class="word-result-header">
                <div>
                    <h1 class="word-title">${wordData.word}</h1>
                    <span class="ipa">/ ${wordData.ipa} /</span>
                </div>
                <button class="btn-audio" onclick="playAudio('${wordData.word}')">üîä</button>
            </div>
            <div class="content">${wordData.explanation}</div>
        `;
    }

    // Show view
    function showView(view) {
        document.getElementById('view-home').classList.add('hidden');
        document.getElementById('view-loading').classList.add('hidden');
        document.getElementById('view-result').classList.add('hidden');
        document.getElementById('view-list').classList.add('hidden');
        
        document.getElementById('view-' + view).classList.remove('hidden');
    }

    // Show tab
    function showTab(tab) {
        currentTab = tab;
        
        // Update nav
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById('nav-' + tab).classList.add('active');

        if (tab === 'home') {
            if (currentWord) {
                showView('result');
            } else {
                showView('home');
            }
        } else {
            showView('list');
            const isHist = tab === 'hist';
            document.getElementById('list-title').textContent = isHist ? 'Search History' : 'Alphabetical List';
            document.getElementById('search-filter').value = '';
            renderList(isHist);
        }
    }

    // Render list
    function renderList(isHistory) {
        const listDiv = document.getElementById('list-items');
        const data = isHistory ? [...history] : [...history].sort((a, b) => a.word.localeCompare(b.word));
        
        if (data.length === 0) {
            listDiv.innerHTML = '<div class="empty-state"><p>No words yet! Start exploring.</p></div>';
        } else {
            listDiv.innerHTML = data.map(item => `
                <div class="list-item" onclick="loadWord('${item.word}')">
                    <div>
                        <strong>${item.word}</strong>
                        <span style="color: #94a3b8; margin-left: 10px;">/ ${item.ipa} /</span>
                    </div>
                    <span>üá∫üá∏</span>
                </div>
            `).join('');
        }
    }

    // Filter list
    function filterList() {
        const query = document.getElementById('search-filter').value.toLowerCase();
        const isHist = currentTab === 'hist';
        const data = isHist ? [...history] : [...history].sort((a, b) => a.word.localeCompare(b.word));
        const filtered = data.filter(item => item.word.includes(query));
        
        const listDiv = document.getElementById('list-items');
        if (filtered.length === 0) {
            listDiv.innerHTML = '<div class="empty-state"><p>No matches found.</p></div>';
        } else {
            listDiv.innerHTML = filtered.map(item => `
                <div class="list-item" onclick="loadWord('${item.word}')">
                    <div>
                        <strong>${item.word}</strong>
                        <span style="color: #94a3b8; margin-left: 10px;">/ ${item.ipa} /</span>
                    </div>
                    <span>üá∫üá∏</span>
                </div>
            `).join('');
        }
    }

    // Load word from history
    function loadWord(word) {
        const wordData = history.find(item => item.word === word);
        if (wordData) {
            currentWord = wordData;
            displayWord(wordData);
            showTab('home');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    }

    // Initialize on load
    init();
</script>
</body>
</html>
