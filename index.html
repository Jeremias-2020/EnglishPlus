<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EnglishPlus+ | American English Simulator</title>
    <style>
        :root {
            --us-blue: #002868;
            --us-red: #bf0a30;
            --us-white: #ffffff;
            --light-gray: #f4f4f9;
            --dark-text: #333;
            --accent: #ffcc00;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            background-color: var(--light-gray);
            color: var(--dark-text);
        }

        /* Header & Navigation */
        header {
            background-color: var(--us-blue);
            color: white;
            padding: 2rem 1rem;
            text-align: center;
            border-bottom: 5px solid var(--us-red);
        }

        header h1 {
            margin: 0;
            font-size: 2.5rem;
            letter-spacing: 2px;
        }

        header p {
            margin: 5px 0 0;
            font-style: italic;
            opacity: 0.9;
        }

        nav {
            display: flex;
            justify-content: center;
            background: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        nav button {
            padding: 1rem 2rem;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: bold;
            color: var(--us-blue);
            transition: 0.3s;
        }

        nav button.active {
            border-bottom: 4px solid var(--us-red);
            color: var(--us-red);
        }

        /* Search Section */
        .search-container {
            max-width: 800px;
            margin: 2rem auto;
            display: flex;
            gap: 10px;
            padding: 0 1rem;
        }

        input[type="text"] {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1.1rem;
        }

        button#searchBtn {
            padding: 12px 25px;
            background-color: var(--us-red);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        /* Content Sections */
        main {
            max-width: 900px;
            margin: 0 auto;
            padding: 1rem;
        }

        .view { display: none; animation: fadeIn 0.5s; }
        .view.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Pedagogical Cards */
        .card {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            line-height: 1.6;
        }

        .section-title {
            color: var(--us-blue);
            border-bottom: 2px solid var(--light-gray);
            margin-top: 1.5rem;
            padding-bottom: 5px;
            text-transform: uppercase;
            font-size: 0.9rem;
            font-weight: 800;
        }

        .result-header { font-size: 2rem; color: var(--us-red); margin-bottom: 0; }
        .pos-tag { font-style: italic; color: #666; }
        
        .pill-container { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
        .pill { 
            background: var(--light-gray); 
            padding: 5px 12px; 
            border-radius: 20px; 
            font-size: 0.9rem;
            border: 1px solid #ddd;
        }

        .example-box {
            background: #fffbe6;
            border-left: 5px solid var(--accent);
            padding: 1rem;
            margin: 1rem 0;
            font-style: italic;
        }

        /* History & AZ List */
        .list-item {
            background: white;
            padding: 10px 15px;
            margin-bottom: 5px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .loader {
            text-align: center;
            display: none;
            font-weight: bold;
            color: var(--us-blue);
        }
    </style>
</head>
<body>

<header>
    <h1>EnglishPlus+ üá∫üá∏</h1>
    <p>American English Vocabulary Simulator by Carlos Mario Navarro</p>
</header>

<nav>
    <button onclick="switchView('simulator')" id="btn-simulator" class="active">Simulator</button>
    <button onclick="switchView('history')" id="btn-history">History Search</button>
    <button onclick="switchView('azlist')" id="btn-azlist">A-Z List</button>
</nav>

<div class="search-container">
    <input type="text" id="wordInput" placeholder="Enter a word or phrasal verb (e.g., 'relentless' or 'break down')">
    <button id="searchBtn">GO</button>
</div>

<div class="loader" id="loader">Consulting American Dictionaries...</div>

<main>
    <section id="view-simulator" class="view active">
        <div id="results" class="card">
            <p style="text-align: center; color: #999;">The simulation will appear here. Start by typing something above!</p>
        </div>
    </section>

    <section id="view-history" class="view">
        <div id="history-container"></div>
    </section>

    <section id="view-azlist" class="view">
        <div id="az-container"></div>
    </section>
</main>

<script>
    /* --- Core Data State --- */
    let historySearch = [];
    let azList = new Set();

    /* --- Elements --- */
    const wordInput = document.getElementById('wordInput');
    const searchBtn = document.getElementById('searchBtn');
    const resultsDiv = document.getElementById('results');
    const loader = document.getElementById('loader');

    /* --- Logic: Detection --- */
    function detectInputType(text) {
        return text.trim().includes(" ") ? "phrase" : "word";
    }

    /* --- API Service --- */
    async function fetchData(word) {
        try {
            loader.style.display = 'block';
            
            // 1. Dictionary Data
            const dictRes = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
            const dictData = dictRes.ok ? await dictRes.json() : null;

            // 2. Synonyms (Datamuse)
            const synRes = await fetch(`https://api.datamuse.com/words?rel_syn=${word}`);
            const synData = await synRes.json();

            // 3. Antonyms (Datamuse)
            const antRes = await fetch(`https://api.datamuse.com/words?rel_ant=${word}`);
            const antData = await antRes.json();

            return { dictData, synonyms: synData.slice(0, 6), antonyms: antData.slice(0, 6) };
        } catch (error) {
            console.error("API Error:", error);
            return null;
        } finally {
            loader.style.display = 'none';
        }
    }

    /* --- Logic: Render Pipeline --- */
    async function performSearch() {
        const query = wordInput.value.trim().toLowerCase();
        if (!query) return;

        const type = detectInputType(query);
        const data = await fetchData(query);

        if (!data.dictData) {
            resultsDiv.innerHTML = `
                <h2 class="result-header">Oops! üá∫üá∏</h2>
                <p><strong>"${query}"</strong> is not registered as a fixed expression or common word in our primary American database.</p>
                <div class="example-box">Tip: Check the spelling or try a more common root word.</div>
            `;
            return;
        }

        // Update State
        historySearch.unshift({ word: query, time: new Date().toLocaleTimeString() });
        if (type === "word") azList.add(query);

        renderResult(query, type, data);
        updateHistoryUI();
        updateAZUI();
    }

    function renderResult(query, type, data) {
        const entry = data.dictData[0];
        const meaning = entry.meanings[0];
        const definition = meaning.definitions[0];
        const phonetic = entry.phonetic || (entry.phonetics[1] ? entry.phonetics[1].text : "N/A");

        let html = "";

        if (type === "word") {
            html = `
                <div class="result-header">Word Analysis: ${entry.word.toUpperCase()}</div>
                <div class="pos-tag">${meaning.partOfSpeech}</div>

                <div class="section-title">English Meaning üá∫üá∏</div>
                <p><strong>${meaning.partOfSpeech}:</strong> ${definition.definition}</p>
                <p><em>Connotation:</em> This word is typically used in ${meaning.partOfSpeech === 'adjective' ? 'descriptive' : 'functional'} contexts within American English to convey ${query.length > 7 ? 'complexity' : 'directness'}.</p>

                <div class="section-title">Phonetics & Pronunciation üó£Ô∏è</div>
                <p><strong>${phonetic}</strong></p>
                <p><em>Sounds like:</em> Roughly pronounced as "${phonetic.replace(/\//g, '')}" with standard American emphasis.</p>

                <div class="section-title">Synonyms ü§ù (The Nuance Map)</div>
                <div class="pill-container">
                    ${data.synonyms.map(s => `<span class="pill"><strong>${s.word}</strong>: (Close match)</span>`).join('') || 'No direct synonyms found.'}
                </div>

                <div class="section-title">Antonyms üö´</div>
                <div class="pill-container">
                    ${data.antonyms.map(a => `<span class="pill"><strong>${a.word}</strong></span>`).join('') || 'No direct antonyms found.'}
                </div>

                <div class="section-title">Real-World Examples üìù</div>
                <div class="example-box">
                    ${definition.example ? `"${definition.example}"` : `Typical usage: "The ${entry.word} nature of the project required extra focus."`}
                </div>

                <div class="section-title">Friendly Practice üá∫üá∏</div>
                <p>In a professional setting, an American might say: <em>"We need to be <strong>${entry.word}</strong> in our pursuit of excellence."</em></p>

                <div class="section-title">Tip Pro üí°</div>
                <p>American speakers often use "${entry.word}" to emphasize intensity. Avoid using it for light or trivial matters to maintain its impact.</p>
            `;
        } else {
            // Phrase / Phrasal Verb Layout
            html = `
                <div class="result-header">Phrase Analysis: ${query.toUpperCase()}</div>
                <div class="section-title">English Meaning üá∫üá∏</div>
                <p><strong>Verb (Phrasal):</strong> ${definition.definition}</p>

                <div class="section-title">The "Action" Perspective</div>
                <p>In the U.S., this phrase implies a breakdown of components or a specific sequence of movements.</p>

                <div class="section-title">Phonetics & Pronunciation üó£Ô∏è</div>
                <p>${phonetic}</p>

                <div class="section-title">Synonyms ü§ù</div>
                <div class="pill-container">
                    ${data.synonyms.map(s => `<span class="pill">${s.word}</span>`).join('') || 'Common in conversational English.'}
                </div>

                <div class="section-title">Real-World Examples üìù</div>
                <div class="example-box">
                    ${definition.example ? `"${definition.example}"` : `Usage: "Let's ${query} so everyone understands the plan."`}
                </div>

                <div class="section-title">Tip Pro üí°</div>
                <p>Phrasal verbs like "${query}" are the bread and butter of American English. Use them in informal meetings to sound more natural!</p>
            `;
        }

        resultsDiv.innerHTML = html;
    }

    /* --- Navigation Logic --- */
    function switchView(viewName) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
        
        document.getElementById(`view-${viewName}`).classList.add('active');
        document.getElementById(`btn-${viewName}`).classList.add('active');
    }

    function updateHistoryUI() {
        const container = document.getElementById('history-container');
        container.innerHTML = historySearch.map(item => `
            <div class="list-item">
                <span><strong>${item.word}</strong></span>
                <small>${item.time}</small>
            </div>
        `).join('');
    }

    function updateAZUI() {
        const container = document.getElementById('az-container');
        const sorted = Array.from(azList).sort();
        container.innerHTML = sorted.map(word => `
            <div class="list-item">
                <span>${word}</span>
                <button onclick="quickSearch('${word}')" style="background:none; border:none; cursor:pointer;">üîç</button>
            </div>
        `).join('');
    }

    function quickSearch(word) {
        wordInput.value = word;
        switchView('simulator');
        performSearch();
    }

    /* --- Listeners --- */
    searchBtn.addEventListener('click', performSearch);
    wordInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') performSearch();
    });

</script>

</body>
</html>
